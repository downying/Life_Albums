<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yahobong.server.users.mapper.FileMapper">

    <insert id="insertFile" parameterType="com.yahobong.server.users.dto.FileDTO" useGeneratedKeys="true" keyProperty="fileNo">
        INSERT INTO files (albumsNo, content, year, month, day, star, filePath)
        VALUES (#{albumsNo}, #{content}, #{year}, #{month}, #{day}, #{star}, #{filePath})
    </insert>
    
    <select id="getThumbnailsByAlbumNo" resultType="com.yahobong.server.users.dto.FileDTO">
        SELECT 
            f.fileNo, 
            f.albumsNo, 
            f.content, 
            f.year, 
            f.month, 
            f.day, 
            f.star, 
            f.filePath
        FROM 
            files f
        INNER JOIN 
            albums a ON f.albumsNo = a.albumsNo
        WHERE 
            a.albumsNo = #{albumsNo}
        ORDER BY 
            f.fileNo ASC
        LIMIT 
            #{offset}, #{limit}
    </select>
    
    <select id="getTotalThumbnailCountByAlbumNo" resultType="int">
        SELECT COUNT(*)
        FROM files f
        INNER JOIN albums a ON f.albumsNo = a.albumsNo
        WHERE a.albumsNo = #{albumsNo}
    </select>

    <!-- fileNo로 단일 파일 정보 가져오기 -->
    <select id="getFileByFileNo" resultType="FileDTO">
        SELECT 
            fileNo, albumsNo, content, year, month, day, star, filePath
        FROM 
            files
        WHERE 
            fileNo = #{fileNo}
    </select>

    <!-- 파일 수정 -->
    <update id="updateFile" parameterType="FileDTO">
        UPDATE files
        SET 
            content = #{content},
            year = #{year},
            month = #{month},
            day = #{day},
            star = #{star},
            filePath = #{filePath}
        WHERE 
            fileNo = #{fileNo}
    </update>

    <!-- 파일 삭제 -->
    <delete id="deleteFile" parameterType="int">
        DELETE FROM files
        WHERE fileNo = #{fileNo}
    </delete>

</mapper>